#!/bin/bash

# Check if internet is up and when I updated Arch, if more than N days propose to update

N=1

last=`cat /var/log/pacman.log | grep "Syu" | awk 'END{ print substr($1,2); print substr($2, 1, length($2)-1) }'`
# Last update in seconds
epochlast=`date -d "$last" +%s`

# Starting from newdate this script shoud ask for update
newdate=$(($epochlast + $N*86400))

now=`date +%s`

# Similar script to autocommit my orgs folder

# In seconds
lastorgs=`git --git-dir /home/sbozzolo/orgs/.git log -1 --date=raw | grep Date | awk '{print $2}'`

# Starting from newdate this script shoud ask for update
newdateorgs=$(($lastorgs + $N*86400))

if [ "$now" -gt "$newdateorgs" ]; then
    if ping -c 1 8.8.8.8 >> /dev/null 2>&1; then
        echo "Comminting orgs"
        commitorgs >> /dev/null &
    else
        exit
    fi
fi

if [ "$now" -gt "$newdate" ]; then
    if ping -c 1 8.8.8.8 >> /dev/null 2>&1; then
        echo "Updating"
        sudo pacman -Syu && pacaur -Syu
        # pacaur -Syu &ccc
    else
        exit
    fi
fi
