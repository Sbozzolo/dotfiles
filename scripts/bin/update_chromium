#!/bin/bash

# Author: sbozzolo
# Date: 01/11/2017

# Script to perform mask or unmask chromium
# to decide when to update it

# Store 1 if there is more than 8 GB of RAM,
# otherwise store 0, this is to mount or
# umount /var/tmp

ram=$(free | awk '/Mem/ {if ($2 > 8*2**20) print 1; else print 0}')

if [ "$ram" -eq 0 ]
then
    echo "I need to umount /var/tmp"
    sudo umount /var/tmp
fi

# Unmask chromium
echo "Unmasking chromium"
sudo awk -i inplace '/chromium/ {print "#"$1; next} 1' /etc/portage/package.mask/chromium

# sudo emerge -av www-client/chromium

# If success, mask again chromium
if [ $? -eq 0 ]
then
    grep -v "chromium" /etc/portage/package.mask/chromium | sudo sponge /etc/portage/package.mask/chromium
    echo ">"$(equery list chromium | awk '{print $1}') | sudo tee -a /etc/portage/package.mask/chromium > /dev/null
    echo "Remasked chromium"
fi

# Local Variables:
# mode: sh-mode
